//tealium universal tag - utag.97 ut4.0.202009031732, Copyright 2020 Tealium.com Inc. All Rights Reserved.
try{(function(id,loader){var u={"id":id};utag.o[loader].sender[id]=u;if(utag.ut===undefined){utag.ut={};}
var match=/ut\d\.(\d*)\..*/.exec(utag.cfg.v);if(utag.ut.loader===undefined||!match||parseInt(match[1])<41){u.loader=function(o,a,b,c,l,m){utag.DB(o);a=document;if(o.type=="iframe"){m=a.getElementById(o.id);if(m&&m.tagName=="IFRAME"){b=m;}else{b=a.createElement("iframe");}o.attrs=o.attrs||{};utag.ut.merge(o.attrs,{"height":"1","width":"1","style":"display:none"},0);}else if(o.type=="img"){utag.DB("Attach img: "+o.src);b=new Image();}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";}if(o.id){b.id=o.id;}for(l in utag.loader.GV(o.attrs)){b.setAttribute(l,o.attrs[l]);}b.setAttribute("src",o.src);if(typeof o.cb=="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){this.onreadystatechange=null;o.cb();}};}}if(o.type!="img"&&!m){l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l=="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}}};}else{u.loader=utag.ut.loader;}
if(utag.ut.typeOf===undefined){u.typeOf=function(e){return({}).toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase();};}else{u.typeOf=utag.ut.typeOf;}
u.ev={"view":1,"link":1};u.initialized=false;u.scriptrequested=false;u.queue=[];u.event_lookup={"AddToCart":{"obj":"cartadd","map":["value","currency","productId","quantity","size"]},"RemoveFromCart":{"obj":"cartremove","map":["value","currency","productId","quantity","size"]},"Purchase":{"obj":"purchase","map":["value","currency","productId","quantity","itemPrice","size"]},"VideoWatch":{"obj":"videowatch","map":["itemId","autoplay","progress","progressPercent"]},"Search":{"obj":"search","map":["keywords"]},"EmailSignup":{"obj":"email","map":["hashedEmail"]}};u.toFixed=function(number,n){number=Number(number);var p=Math.pow(10,n);return parseFloat((Math.round(number*p)/p).toFixed(n));};u.merge=function(name,source,target){for(var i=0,slen=source.length;i<slen;i++){var obj=target[i]||{};if(!obj[name]){obj[name]=source[i];target[i]=obj;}}
return true;};u.std_params={"value":function(g,event){var value=u.data.ecom.product_selling_price;if(!value){if(event==="AddToCart"||event==="RemoveFromCart"){value=u.data.ecom.product_selling_price;}
else{value=u.data.ecom.order_subtotal||u.data.ecom.order_total;}}
if(value.length){g.properties.value=parseFloat(value[0]);}
return true;},"currency":function(g){var currency=g.properties.currency=u.data.ecom.order_currency;if(currency){g.properties.currency=currency;}
return true;},"productId":function(g,event){var pid=g.properties.productId||u.data.ecom.product_id;if(pid.length){if(event==="Purchase"){var cart=g.properties.cart=g.properties.cart||[];u.merge("productId",pid,cart);}
else{g.properties.productId=u.val(pid);}}
return true;},"quantity":function(g,event){var qty=g.properties.quantity||u.data.ecom.product_quantity;if(qty.length){for(var i=0,qlen=qty.length;i<qlen;i++){qty[i]=parseInt(qty[i],10);}
if(event==="Purchase"){var cart=g.properties.cart=g.properties.cart||[];u.merge("quantity",qty,cart);}
else{g.properties.quantity=u.val(qty);}}
return true;},"itemPrice":function(g,event){var price=g.properties.itemPrice||u.data.ecom.product_unit_price;if(price.length){for(var i=0,plen=price.length;i<plen;i++){price[i]=u.toFixed(price[i],2);}
if(event==="Purchase"){var cart=g.properties.cart=g.properties.cart||[];u.merge("itemPrice",price,cart);}}
return true;},"size":function(g,event){var size=g.properties.size||u.data.size;if(size){if(event==="Purchase"){var cart=g.properties.cart=g.properties.cart||[];u.merge("size",size,cart);}
else{g.properties.size=u.val(size);}}
return true;},"itemId":function(g){var itemId=g.properties.itemId||u.data.itemId;if(itemId){g.properties.itemId=itemId;}
return true;},"autoplay":function(g){var autoplay=g.properties.autoplay||u.data.autoplay;if(autoplay){g.properties.autoplay=autoplay;}
return true;},"progress":function(g){var progress=g.properties.progress||u.data.progress;if(progress){g.properties.progress=progress;}
return true;},"progressPercent":function(g){var progressPercent=g.properties.progressPercent||u.data.progressPercent;if(progressPercent){g.properties.progressPercent=progressPercent;}
return true;},"keywords":function(g){var keywords=g.properties.keywords||u.data.keywords;if(keywords){g.properties.keywords=keywords;}
return true;},"hashedEmail":function(g){var hashedEmail=g.properties.hashedEmail||u.data.hashedEmail;if(hashedEmail){g.properties.hashedEmail=hashedEmail;}
return true;},};u.map_func=function(arr,obj,item){var i=arr.shift();obj[i]=obj[i]||{};if(arr.length>0){u.map_func(arr,obj[i],item);}
else{obj[i]=item;}
return true;};u.val=function(value){return u.typeOf(value)==="array"?value[0]:value;};u.remove_empty=function(a){var b,t;for(b in utag.loader.GV(a)){t=u.typeOf(a[b]);if(t==="object"){u.remove_empty(a[b]);if(utag.ut.isEmptyObject(a[b])){try{delete a[b];}catch(e){a[b]=undefined;}}}else if(!((a[b]===0||a[b]===false)?!0:(t==="array"&&a[b].length===0)?!1:!!a[b])){try{delete a[b];}catch(e){a[b]=undefined;}}}
return a;};u.calc_items=function(quan){var q,i=0;for(q=0;q<quan.length;q++){i+=parseInt(quan[q]);}
return i;};u.encode=function(obj){function escape(val){var type=u.typeOf(val);if(/string/.test(type)){return window.encodeURIComponent(val);}
else if(/object|array/.test(type)){return check(val);}
return val;}
function check(obj){var type=u.typeOf(obj),key;if(/object/.test(type)){for(key in obj){if(obj.hasOwnProperty(key)){obj[key]=escape(obj[key]);}}}
else if(/array/.test(type)){for(var i=0,olen=obj.length;i<olen;i++){obj[i]=escape(obj[i]);}}
else{obj=escape(obj);}
return obj;}
return check(obj);};u.map={"event_action:add to cart":"AddToCart","event_action:sign in modal":"SignIn","event_action:create an account modal":"CreateAccount","dy_page_type":"context.type","email_hash":"email.properties.hashedEmail,SignIn.properties.hashedEmail,CreateAccount.properties.hashedEmail","dy_context_data":"context.data","cp.urbn_language":"lng","dy_site_id":"scsec","event_name:email_signup":"EmailSignup","product_id":"product_id","product_quantity":"product_quantity","_sm_97_10":"SignIn.name","_sm_97_11":"CreateAccount.name"};u.extend=[function(a,b){try{b['_sm_97_10']="login-v1";}catch(e){utag.DB(e);}
try{b['_sm_97_11']="signup-v1";}catch(e){utag.DB(e);}},function(a,b){if(typeof b['customer_email']!='undefined'&&b['customer_email']!=''&&b['customer_email']!=null&&b['customer_email']!='0'){b['email_hash']=[(CryptoJS.MD5(b.customer_email)).toString(CryptoJS.enc.Hex)];}},function(a,b){try{if(1){if(typeof b['customer_email']!='undefined'&&b['customer_email']!=''&&b['customer_email']!=null&&b['customer_email']!='0'){b['customer_email_hash']=[(CryptoJS.MD5(b.customer_email)).toString(CryptoJS.enc.Hex)];}}}catch(e){utag.DB(e)}},function(a,b,c,d,e,f,g){if(1){d=b['page_type'];if(typeof d=='undefined')return;c=[{'home':'HOMEPAGE'},{'Cart':'CART'},{'Checkout':'CART'},{'receipt':'CART'},{'category':'CATEGORY'},{'product':'PRODUCT'}];var m=false;for(e=0;e<c.length;e++){for(f in utag.loader.GV(c[e])){if(d==f){b['dy_page_type']=c[e][f];m=true};};if(m)break};if(!m)b['dy_page_type']='OTHER';}},function(a,b){try{if(b['dy_page_type'].toString().indexOf('PRODUCT')>-1||b['dy_page_type'].toString().indexOf('CART')>-1){b['dy_context_data']=b['product_id']}}catch(e){utag.DB(e);}},function(a,b){try{if(b['dy_page_type'].toString().indexOf('CATEGORY')>-1){b['dy_context_data']=b['page_breadcrumb']}}catch(e){utag.DB(e);}},function(a,b,c,d,e,f,g){if(1){d=b['cp.urbn_site_id'];if(typeof d=='undefined')return;c=[{'an-uk':'8768219'},{'an-de':'8768219'},{'an-fr':'8768219'}];var m=false;for(e=0;e<c.length;e++){for(f in utag.loader.GV(c[e])){if(d==f){b['dy_site_id']=c[e][f];m=true};};if(m)break};if(!m)b['dy_site_id']='8767825';}},function(a,b,c,d,e,f,g){if(1){d=b['dom.domain'];if(typeof d=='undefined')return;c=[{'an-dev.urbn.com':'8769186'}];var m=false;for(e=0;e<c.length;e++){for(f in utag.loader.GV(c[e])){if(d==f){b['dy_site_id']=c[e][f];m=true};};if(m)break};}}];u.loader_cb=function(a){utag.DB("send:97:CALLBACK");u.initialized=true;if(u.data.context)
var g={},i,j,_event;if(u.data.evt_list.toString().indexOf("Purchase")===-1&&u.data.ecom.order_id){u.data.evt_list.push("Purchase");}
for(i=0;i<u.data.evt_list.length;i++){_event=u.data.evt_list[i];f=u.event_lookup[_event];c=f?f.map:[];f=f?f.obj:_event;g=u.data[f]=u.data[f]||{};g.properties=g.properties||{};for(j=0;j<c.length;j++){u.std_params[c[j]](g,_event);}
if(_event==="AddToCart"){g.name="Add to Cart";g.properties.dyType=g.properties.dyType||"add-to-cart-v1";}
else if(_event==="RemoveFromCart"){g.name="Remove from Cart";g.properties.dyType=g.properties.dyType||"remove-from-cart-v1";}
else if(_event==="Purchase"){g.name="Purchase";g.properties.dyType=g.properties.dyType||"purchase-v1";}else if(_event==="VideoWatch"){g.name="Video Watch";g.properties.dyType=g.properties.dyType||"video-watch-v1";}else if(_event==="Search"){g.name="Keyword Search";g.properties.dyType=g.properties.dyType||"keyword-search-v1";}else if(_event==="EmailSignup"){g.name="Newsletter Subscription";g.properties.dyType=g.properties.dyType||"newsletter-subscription-v1";}else if(_event==="SignIn"){g.properties.dyType=g.properties.dyType||"login-v1";if(g.properties.hashedEmail&&g.properties.hashedEmail.length>0){g.properties.hashedEmail=g.properties.hashedEmail[0];}}else if(_event==="CreateAccount"){g.properties.dyType=g.properties.dyType||"signup-v1";if(g.properties.hashedEmail&&g.properties.hashedEmail.length>0){g.properties.hashedEmail=g.properties.hashedEmail[0];}}else if(_event&&!u.event_lookup[_event]){g=u.data[_event];}
if(_event){g=u.remove_empty(g);window.DY.API("event",g);}}
utag.DB("send:97:CALLBACK:COMPLETE");};u.callBack=function(){var data={};while(data=u.queue.shift()){u.data=data.data;u.loader_cb(data.a);}};u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){utag.DB("send:97");utag.DB(b);var c,d,e,f,g,h,evt=[];u.data={"base_url":"//cdn.dynamicyield.com/api/##utag_scssec##","scsec":"8767825","evt_list":[],"videowatch":{},"search":{},"email":{},"product_id":[],"product_name":[],"product_quantity":[],"product_unit_price":[],"product_size":[],"ecom":{}};for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){if(typeof utag_err!='undefined'){utag_err.push({e:'extension error:'+e,s:utag.cfg.path+'utag.'+id+'.js',l:c,t:'ex'})}}};utag.DB("send:97:EXTENSIONS");utag.DB(b);c=[];for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.map_func(e[f].split("."),u.data,b[d]);}}else{h=d.split(":");if(h.length===2&&b[h[0]]===h[1]){if(u.map[d]){evt=evt.concat(u.map[d].split(","));}}}}
utag.DB("send:97:MAPPINGS");utag.DB(u.data);g=u.data.ecom;g.order_id=u.data.order_id||b._corder||"";g.order_subtotal=u.data.order_subtotal||b._csubtotal||"";g.order_currency=u.data.order_currency||b._ccurrency||"";g.product_selling_price=b.product_selling_price;if(u.data.product_id.length===0&&b._cprod!==undefined){g.product_id=b._cprod.slice(0);}else{g.product_id=u.data.product_id;}
if(u.data.product_name.length===0&&b._cprodname!==undefined){g.product_name=b._cprodname.slice(0);}else{g.product_name=u.data.product_name;}
if(u.data.product_quantity.length===0&&b._cquan!==undefined){g.product_quantity=b._cquan.slice(0);}else{g.product_quantity=u.data.product_quantity;}
if(u.data.product_unit_price.length===0&&b._cprice!==undefined){g.product_unit_price=b._cprice.slice(0);}else{g.product_unit_price=u.data.product_unit_price;}
if(u.data.evt_list&&u.typeOf(u.data.evt_list)!=="array"){u.data.evt_list=u.data.evt_list.split(/\s*,\s*/);}
u.data.evt_list=u.data.evt_list.concat(evt);if(!u.data.scsec){utag.DB(u.id+": Tag not fired: Required attribute not populated");return;}
u.data.base_url=u.data.base_url.replace("##utag_scssec##",u.data.scsec);if(!u.data.scsec){return true;}
window.DY=window.DY||{"scsec":u.data.scsec,"API":function(){(window.DY.API.actions=window.DY.API.actions||[]).push(arguments);}};if(a==="view"){if(u.data.context&&u.data.context.type){var context=u.data.context,contextdata={};if(/^homepage$/i.test(context.type)){u.scriptrequested=true;contextdata.type="HOMEPAGE";}
else if(/^category$/i.test(context.type)){u.scriptrequested=true;contextdata.type="CATEGORY";contextdata.data=context.data;}
else if(/^article$/i.test(context.type)){u.scriptrequested=true;contextdata.type="POST";contextdata.data=context.data;}
else if(/^product$/i.test(context.type)){u.scriptrequested=true;contextdata.type="PRODUCT";contextdata.data=context.data;}
else if(/^cart$/i.test(context.type)){contextdata.type="CART";contextdata.data=context.data;}
if(contextdata.type){window.DY.recommendationContext=contextdata;}}}
u.loader_cb(a);utag.DB("send:97:COMPLETE");}};utag.o[loader].loader.LOAD(id);}("97","urbanoutfitters.a15-urbnweb"));}catch(error){utag.DB(error);}
